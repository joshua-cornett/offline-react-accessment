<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: hooks/useName.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: hooks/useName.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { useState, useEffect, useRef } from 'react';
import { isNameValid as API_validateName } from '../mock-api/apis';
import { useDebounce } from './useDebouncing';
import { useSubmissions } from './useSubmissions';

/**
 * Custom hook for name input validation and management.
 * Implements debouncing and out-of-order validation aborts
 *
 * @returns {object} Object containing:
 *  - name (string): The current name.
 *  - setName (Function): Setter for the name.
 *  - isNameValid (boolean|null): The validation status, null without input.
 *  - validating (boolean): Flag indicating if currently validating
 */
export const useName = () => {
  // State management and custom hooks
  const [name, setName] = useState('');
  const [isNameValid, setIsNameValid] = useState(null);
  const [isNameAvailable, setIsNameAvailable] = useState(true);
  const [validating, setValidating] = useState(false);
  const debouncedName = useDebounce(name, 100); // Debouncing the name input to reduce frequency of validation calls.
  const validationSeq = useRef(0); // Sequence number to track the latest validation request.
  const { checkNameAvailability } = useSubmissions(); // Assume this method is available

  useEffect(() => {
    const controller = new AbortController(); // AbortController to manage fetch cancellations.
    const currentSeq = ++validationSeq.current; // Increment sequence number for new validation requests.

    // Function to perform name input validation.
    const performValidation = async () => {
      if (!debouncedName) {
        // If no debounce, stop validating.
        setIsNameValid(null);
        setIsNameAvailable(checkNameAvailability(debouncedName));

        setValidating(false);
        return;
      }

      setValidating(true); // Indicate validation start (prevents apparent feedback lag)
      setIsNameAvailable(true); // Empty name is not a duplicate by default

      try {
        const result = await API_validateName(debouncedName, {
          signal: controller.signal,
        }); // Perform the validation call with an abort signal.
        if (currentSeq === validationSeq.current) {
          // Finalize validation
          setIsNameValid(result); // Set the validation result.
          setValidating(false); // Reset the validating flag once validation is complete.
        }
      } catch (error) {
        if (error.name !== 'AbortError') {
          // Handle errors that are not aborts.
          console.error('Error validating name:', error);
          if (currentSeq === validationSeq.current) {
            // Stop validation on error.
            setIsNameValid(false);
            setValidating(false);
          }
        }
      }
    };

    performValidation(); // Execute the validation function.

    return () => {
      controller.abort(); // Abort fetch on change or unmount.
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [debouncedName]); // Effect triggered by debounce

  return {
    name,
    setName,
    isNameValid,
    isNameAvailable,
    validating,
  };
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#App">App</a></li><li><a href="global.html#Form">Form</a></li><li><a href="global.html#Location">Location</a></li><li><a href="global.html#Name">Name</a></li><li><a href="global.html#Submissions">Submissions</a></li><li><a href="global.html#getLocations">getLocations</a></li><li><a href="global.html#isNameValid">isNameValid</a></li><li><a href="global.html#root">root</a></li><li><a href="global.html#useDebounce">useDebounce</a></li><li><a href="global.html#useLocations">useLocations</a></li><li><a href="global.html#useName">useName</a></li><li><a href="global.html#useSubmissions">useSubmissions</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Tue Apr 23 2024 17:47:47 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
