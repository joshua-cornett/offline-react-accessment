<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: hooks/useName.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: hooks/useName.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { useState, useEffect } from 'react';
import { isNameValid as API_validateName } from '../mock-api/apis';
import { useDebounce } from './useDebouncing';
import { useSubmissions } from '../contexts/SubmissionsContext';

/**
 * Custom hook for managing the name input's validation and availability.
 * It performs debouncing to minimize excessive validation requests and directly
 * checks name availability against stored submissions.
 *
 * @returns {object} Contains the current name state, validation status, availability,
 * and flags for ongoing validation.
 */
export const useName = () => {
  // States for name and validation
  const [name, setName] = useState('');
  const [isNameValid, setIsNameValid] = useState(null);
  const [isNameAvailable, setIsNameAvailable] = useState(true);
  const [validating, setValidating] = useState(false);
  // The debounced version of the name, used to reduce frequency of validation calls
  const debouncedName = useDebounce(name, 300);
  // Utilize the checkNameAvailability function from useSubmissions context provider
  const { checkNameAvailability } = useSubmissions();

  // Additional state to manually control the status message
  const [manualStatus, setManualStatus] = useState(null);

  // Function to determine the status message and color based on current validation state
  const getStatusMessage = () => {
    if (!debouncedName) {
      return { message: 'Please enter a name', color: 'gray' }; // Guidance when input is empty
    }
    if (validating) {
      return { message: 'Checking...', color: 'blue' };
    }
    if (!isNameValid &amp;&amp; debouncedName) {
      return { message: 'Invalid', color: 'red' }; // Invalid state when there's input
    }
    if (!isNameAvailable) {
      return { message: 'Unavailable', color: 'orange' };
    }
    if (isNameValid &amp;&amp; isNameAvailable) {
      return { message: 'Available', color: 'green' };
    }
    return { message: '', color: 'black' }; // Default case
  };

  useEffect(() => {
    if (manualStatus) {
      return; // If manual status is set, skip the automatic status setting
    }

    // If debouncedName is falsy, reset validation and availability
    if (!debouncedName) {
      setIsNameValid(null); // Avoid setting as 'Invalid'
      setIsNameAvailable(true);
      setValidating(false);
      setManualStatus({ message: 'Please enter a name', color: 'gray' });

      return;
    }

    // Start validating when name changes
    setValidating(true);

    // Perform the validation via API
    API_validateName(debouncedName)
      .then((isValid) => {
        setIsNameValid(isValid); // Update the validity
        setIsNameAvailable(checkNameAvailability(debouncedName)); // Directly check availability
        setValidating(false); // Mark the end of the validation
        setManualStatus(null); // Clear manual status once validation completes
      })
      .catch((error) => {
        // Handle any errors during validation
        console.error('Validation error:', error);
        setIsNameValid(false);
        setValidating(false);
      });
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [debouncedName]); // This effect depends on debouncedName, which updates on name change

  // Determine if the name is ready for submission
  const ready = !validating &amp;&amp; isNameValid &amp;&amp; isNameAvailable;

  return {
    name,
    setName,
    ready,
    status: manualStatus || getStatusMessage(),
    setManualStatus,
  };
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#App">App</a></li><li><a href="global.html#Form">Form</a></li><li><a href="global.html#Location">Location</a></li><li><a href="global.html#Name">Name</a></li><li><a href="global.html#Submissions">Submissions</a></li><li><a href="global.html#getLocations">getLocations</a></li><li><a href="global.html#isNameValid">isNameValid</a></li><li><a href="global.html#root">root</a></li><li><a href="global.html#useDebounce">useDebounce</a></li><li><a href="global.html#useLocations">useLocations</a></li><li><a href="global.html#useName">useName</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Wed Apr 24 2024 08:41:46 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
